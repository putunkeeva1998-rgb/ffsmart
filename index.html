<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FFMSC Smart –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f4);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-link: var(--tg-theme-link-color, #007bff);
            --tg-button: var(--tg-theme-button-color, #2481cc);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
        }

        html, body {
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--tg-bg);
            color: var(--tg-text);
            touch-action: manipulation;
        }

        header {
            background: var(--tg-button);
            color: var(--tg-button-text);
            padding: 10px;
            font-size: 1.1rem;
            text-align: center;
            flex-shrink: 0;
            font-weight: bold;
        }

        nav {
            display: flex;
            gap: 5px;
            padding: 5px;
            flex-shrink: 0;
        }

        nav button {
            flex: 1;
            padding: 10px;
            font-size: 0.85rem;
            border: none;
            border-radius: 10px;
            background: var(--tg-secondary-bg);
            color: var(--tg-text);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        nav button.active {
            background: var(--tg-button);
            color: var(--tg-button-text);
        }

        section {
            display: none;
            flex-direction: column;
            flex-grow: 1;
            overflow: hidden;
        }

        section.active { display: flex; }

        .table-container {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            position: sticky;
            top: 0;
            background: var(--tg-secondary-bg);
            z-index: 10;
            padding: 12px 4px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        td {
            padding: 10px 4px;
            border-bottom: 1px solid var(--tg-secondary-bg);
            text-align: center;
        }

        .service-name { text-align: left; width: 50%; line-height: 1.2; font-weight: 500; }

        input[type=number] {
            width: 60px;
            padding: 8px;
            border: 1px solid var(--tg-secondary-bg);
            border-radius: 8px;
            background: var(--tg-secondary-bg);
            color: var(--tg-text);
            text-align: center;
            font-size: 16px;
            outline: none;
            -webkit-appearance: none;
            margin: 0;
        }

        .results-footer {
            background: var(--tg-secondary-bg);
            padding: 15px;
            flex-shrink: 0;
            border-top: 1px solid rgba(0,0,0,0.1);
            margin-top: auto;
        }

        .res-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .final-price-box {
            text-align: center;
            margin: 8px 0;
        }

        .final-price {
            font-size: 1.7rem;
            font-weight: bold;
            color: var(--tg-link);
        }

        .action-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: var(--tg-button);
            color: var(--tg-button-text);
            font-weight: bold;
            font-size: 1rem;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>

<header>FFMSC Smart –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</header>

<nav>
    <button onclick="showSection('calc', this)" class="active">üì¶ –†–∞—Å—á–µ—Ç</button>
    <button onclick="showSection('address', this)">üìç –ê–¥—Ä–µ—Å</button>
    <button onclick="showSection('contacts', this)">‚òéÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
</nav>

<section id="calc" class="active">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th class="service-name">–£—Å–ª—É–≥–∞</th>
                    <th>‚ÇΩ</th>
                    <th>–ö–æ–ª-–≤–æ</th>
                    <th>–°—É–º–º–∞</th>
                </tr>
            </thead>
            <tbody id="serviceTable">
                <tr data-name="–ü—Ä–∏–µ–º–∫–∞, —Å–æ—Ä—Ç., —Ä–∞—Å–ø—Ä–µ–¥.">
                    <td class="service-name">–ü—Ä–∏–µ–º–∫–∞, —Å–æ—Ä—Ç., —Ä–∞—Å–ø—Ä–µ–¥.</td>
                    <td class="price">10.00</td>
                    <td><input type="number" inputmode="decimal" class="item-count" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –®–ö (–¥–≤–æ–π–Ω–∞—è)">
                    <td class="service-name">–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –®–ö (–¥–≤–æ–π–Ω–∞—è)</td>
                    <td class="price">8.00</td>
                    <td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ß–ó (–¥–≤–æ–π–Ω–∞—è)">
                    <td class="service-name">–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ß–ó (–¥–≤–æ–π–Ω–∞—è)</td>
                    <td class="price">8.00</td>
                    <td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±—Ä–∞–∫">
                    <td class="service-name">–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±—Ä–∞–∫</td>
                    <td class="price">15.00</td>
                    <td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –±–∏—Ä–æ–∫">
                    <td class="service-name">–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –±–∏—Ä–æ–∫</td>
                    <td class="price">10.00</td>
                    <td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–ö–æ—Ä–æ–±">
                    <td class="service-name">–ö–æ—Ä–æ–±</td>
                    <td class="price">135.00</td>
                    <td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏">
                    <td class="service-name">–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤–∫–∏</td>
                    <td class="price">500.00</td>
                    <td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td>
                    <td class="lineTotal">0.00</td>
                </tr>
                <tr data-name="–ö–æ–ª–µ–¥–∏–Ω–æ"><td class="service-name">–ö–æ–ª–µ–¥–∏–Ω–æ</td><td class="price">350.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å"><td class="service-name">–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å</td><td class="price">350.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–¢—É–ª–∞"><td class="service-name">–¢—É–ª–∞</td><td class="price">450.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–†—è–∑–∞–Ω—å"><td class="service-name">–†—è–∑–∞–Ω—å</td><td class="price">500.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–ö–æ—Ç–æ–≤—Å–∫"><td class="service-name">–ö–æ—Ç–æ–≤—Å–∫</td><td class="price">650.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–ö–∞–∑–∞–Ω—å"><td class="service-name">–ö–∞–∑–∞–Ω—å</td><td class="price">750.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä"><td class="service-name">–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä</td><td class="price">750.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–°–∞—Ä–∞–ø—É–ª"><td class="service-name">–°–∞—Ä–∞–ø—É–ª</td><td class="price">850.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–ù–æ–≤–æ—Å–µ–º–µ–π–∫–∏–Ω–æ"><td class="service-name">–ù–æ–≤–æ—Å–µ–º–µ–π–∫–∏–Ω–æ</td><td class="price">850.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–ù–µ–≤–∏–Ω–Ω–æ–º—ã—Å—Å–∫"><td class="service-name">–ù–µ–≤–∏–Ω–Ω–æ–º—ã—Å—Å–∫</td><td class="price">850.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
                <tr data-name="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"><td class="service-name">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</td><td class="price">1000.00</td><td><input type="number" inputmode="decimal" value="" placeholder="0" oninput="updateTotal()"></td><td class="lineTotal">0.00</td></tr>
            </tbody>
        </table>
    </div>

    <div class="results-footer">
        <div class="res-row">
            <span>–°–∫–∏–¥–∫–∞ (%): <input type="number" inputmode="decimal" id="discount" value="" placeholder="0" oninput="updateTotal()" style="width: 50px;"></span>
            <span>–ó–∞ 1 –µ–¥: <b id="perItem">0.00</b> ‚ÇΩ</span>
        </div>
        <div class="final-price-box">
            <div style="font-size: 0.8rem; text-transform: uppercase; color: #666;">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</div>
            <div class="final-price" id="finalTotal">0.00 ‚ÇΩ</div>
        </div>
        <div style="display: flex; gap: 8px;">
            <button onclick="resetCalc()" class="action-btn" style="background: #e0e0e0; color: #000; flex: 1;">–°–±—Ä–æ—Å</button>
            <button class="action-btn" style="flex: 2;" onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç</button>
        </div>
    </div>
</section>

<section id="address">
    <div style="padding: 40px 20px; text-align: center;">
        <p style="font-size: 1.2rem;">–≥. –ú–æ—Å–∫–≤–∞, –ß–∞–≥–∏–Ω—Å–∫–∞—è 4 —Å—Ç—Ä 13</p>
        <button class="action-btn" onclick="copyAddr()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
    </div>
</section>

<section id="contacts">
    <div style="padding: 40px 20px; text-align: center;">
        <p>–°–≤—è–∑—å –≤ Telegram: <b>@smartfffull</b></p>
        <button class="action-btn" onclick="window.open('https://t.me/smartfffull')">–ù–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É</button>
    </div>
</section>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    function updateTotal() {
        const rows = document.querySelectorAll('#serviceTable tr');
        let totalSum = 0;
        let mainQty = 0;

        rows.forEach(row => {
            const price = parseFloat(row.querySelector('.price').innerText) || 0;
            const qtyInput = row.querySelector('input');
            const qty = parseInt(qtyInput.value) || 0;
            
            const rowSum = price * qty;
            row.querySelector('.lineTotal').innerText = rowSum.toFixed(2);
            totalSum += rowSum;

            if (qtyInput.classList.contains('item-count')) {
                mainQty = qty;
            }
        });

        const discountVal = parseFloat(document.getElementById('discount').value) || 0;
        const discountedTotal = totalSum * (1 - discountVal / 100);

        document.getElementById('finalTotal').innerText = discountedTotal.toFixed(2) + ' ‚ÇΩ';
        
        const perItemVal = mainQty > 0 ? (discountedTotal / mainQty).toFixed(2) : '0.00';
        document.getElementById('perItem').innerText = perItemVal;
    }

    function showSection(id, btn) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function resetCalc() {
        document.querySelectorAll('input').forEach(i => i.value = "");
        updateTotal();
    }

    function copyAddr() {
        navigator.clipboard.writeText("–≥. –ú–æ—Å–∫–≤–∞, –ß–∞–≥–∏–Ω—Å–∫–∞—è 4 —Å—Ç—Ä 13");
        tg.showAlert("–ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
    }

    function sendData() {
        const rows = document.querySelectorAll('#serviceTable tr');
        let message = "üì¶ *–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç FFMSC Smart*\n\n";
        let hasData = false;

        rows.forEach(row => {
            const name = row.getAttribute('data-name');
            const qty = parseInt(row.querySelector('input').value) || 0;
            const lineTotal = row.querySelector('.lineTotal').innerText;
            
            if (qty > 0) {
                message += `‚Ä¢ ${name}: ${qty} —à—Ç. ‚Äî ${lineTotal} ‚ÇΩ\n`;
                hasData = true;
            }
        });

        const discount = document.getElementById('discount').value;
        if (discount > 0) {
            message += `\nüè∑ –°–∫–∏–¥–∫–∞: ${discount}%`;
        }

        message += `\n\nüí∞ *–ò–¢–û–ì–û: ${document.getElementById('finalTotal').innerText}*`;
        message += `\nüì¶ –¶–µ–Ω–∞ –∑–∞ 1 –µ–¥: ${document.getElementById('perItem').innerText} ‚ÇΩ`;
        message += `\n\nüë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: @smartfffull`;

        if (!hasData) {
            tg.showAlert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö–æ—Ç—è –±—ã –¥–ª—è –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏.");
            return;
        }

        tg.sendData(message);
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
          this.blur();
        }
      });
    });
    }
// –ö–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
  window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const page = urlParams.get('page');
    if (page) {
      if (page === 'calc') showSection('calc', document.querySelector('nav button:nth-child(1)'));
      if (page === 'address') showSection('address', document.querySelector('nav button:nth-child(2)'));
      if (page === 'contacts') showSection('contacts', document.querySelector('nav button:nth-child(3)'));
    }
  });
</script>
</body>
</html>
